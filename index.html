<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>NICO-VOXBOT ACADEMY</title>
<style>
  :root{--brand:#153A6B;--accent:#0aa;--bg:#f3f7fb;--muted:#6b7a86}
  body{font-family:Inter,Arial,Helvetica,sans-serif;margin:0;background:var(--bg);color:#072235}
  header{background:var(--brand);color:#fff;padding:20px 12px;text-align:center}
  header h1{margin:0;font-size:1.5rem}
  header p{margin:6px 0 0;font-weight:600}
  .wrap{max-width:980px;margin:18px auto;padding:12px}
  .card{background:#fff;border-radius:12px;padding:14px;margin-bottom:14px;box-shadow:0 8px 24px rgba(6,30,60,0.06)}
  input,select,button,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef6;margin-top:8px;box-sizing:border-box}
  button{background:var(--brand);color:white;border:none;cursor:pointer;padding:10px 14px}
  .row{display:flex;gap:10px}
  .row>*{flex:1}
  .small{font-size:0.9rem;color:var(--muted)}
  .float-ia{position:fixed;right:18px;bottom:96px;background:linear-gradient(135deg,var(--brand),#0ca6e0);color:white;padding:12px 16px;border-radius:999px;box-shadow:0 10px 30px rgba(15,63,112,0.25);z-index:9999;cursor:pointer}
  .hidden{display:none!important}
  .avatar{width:72px;height:72px;border-radius:999px;object-fit:cover;border:3px solid #fff}
  .options button{margin-top:6px}
  .lang-list{display:flex;flex-wrap:wrap;gap:8px}
  .lang-list button{background:#e8f6ff;color:var(--brand);border-radius:8px;padding:8px 10px;border:1px solid #d6eefb;cursor:pointer}
  .task{background:#fbfdff;border-radius:8px;padding:8px;margin:6px 0;border:1px dashed #e2f0fb}
  .disabled{opacity:0.5;pointer-events:none}
  footer{padding:12px;text-align:center;color:var(--muted)}
  @media(min-width:900px){header h1{font-size:2rem}}
</style>
</head>
<body>

<header>
  <h1>NICO-VOXBOT ACADEMY</h1>
  <p><strong>La Forma M√°s Inteligente de Aprender Cualquier Idioma</strong></p>
</header>

<div class="wrap">

  <!-- misi√≥n, eslogan y contacto -->
  <div class="card">
    <div><strong id="mision"><!-- llenado por JS --></strong></div>
    <div class="small" style="margin-top:8px">
      Contacto: <a href="mailto:academynicovoxbot@gmail.com">academynicovoxbot@gmail.com</a> ¬∑ Soporte t√©cnico: <a href="tel:+18297425652">829-742-5652</a>
    </div>
  </div>

  <!-- Registro r√°pido -->
  <div class="card" id="card-register">
    <h3>Registro / Iniciar sesi√≥n</h3>
    <input id="reg_name" placeholder="Nombre completo"/>
    <div class="row">
      <input id="reg_age" placeholder="Edad"/>
      <input id="reg_email" placeholder="Correo electr√≥nico"/>
    </div>
    <div style="margin-top:8px">
      <input id="reg_contact" placeholder="Contacto / Tel√©fono (opcional)"/>
    </div>
    <div style="margin-top:8px">
      <input type="file" id="reg_avatar" accept="image/*"/>
    </div>
    <div class="row" style="margin-top:10px">
      <button onclick="registrar()">Registrarse</button>
      <button onclick="abrirSesion()">Iniciar sesi√≥n</button>
    </div>
    <div class="small" style="margin-top:8px">Al registrarte se crea tu perfil localmente y se guarda tu progreso.</div>
  </div>

  <!-- Planes y precios (bot√≥n de pago inactivo) -->
  <div class="card">
    <h3>Planes y Precios</h3>
    <p class="small">Mensual: <strong>US$3.99 / mes</strong> ¬∑ Anual: <strong>US$39.99 / a√±o</strong></p>
    <div class="row">
      <button id="btn-pay" class="disabled" title="Activar pagos al configurar PayPal/Stripe">Suscribirme (desactivado)</button>
      <button onclick="prepararPagoMock()">Configurar (modo prueba)</button>
    </div>
    <div class="small" style="margin-top:6px">Los botones est√°n listos en el c√≥digo pero inactivos hasta que pegues las claves.</div>
  </div>

  <!-- Selector idiomas -->
  <div class="card">
    <h3>Idiomas (20)</h3>
    <div class="lang-list" id="langList"></div>
  </div>

  <!-- √Årea principal: Mi curso -->
  <div class="card hidden" id="panel-curso">
    <h2>Mi Curso ‚Äî NICO-VOXBOT</h2>

    <div class="row">
      <div>
        <label><strong>Idioma:</strong></label>
        <select id="idiomaSelect" onchange="cambiarIdioma()"></select>
      </div>
      <div>
        <label><strong>Nivel:</strong></label>
        <div style="padding:10px;background:#f5fbff;border-radius:8px;text-align:center"><span id="nivel">1</span></div>
      </div>
    </div>

    <div style="margin-top:12px">
      <h3 id="pregunta">‚Äî Pregunta ‚Äî</h3>
      <div class="row" style="margin-top:8px">
        <button class="option" onclick="respuesta(0)" id="opt0">Opci√≥n A</button>
        <button class="option" onclick="respuesta(1)" id="opt1">Opci√≥n B</button>
      </div>
      <div class="row" style="margin-top:8px">
        <button class="option" onclick="respuesta(2)" id="opt2">Opci√≥n C</button>
        <button class="option" onclick="respuesta(3)" id="opt3">Opci√≥n D</button>
      </div>

      <p id="mensaje" class="small"></p>

      <div style="display:flex;gap:8px;margin-top:8px">
        <button onclick="hablarPregunta()">üîä Escuchar</button>
        <button id="listenBtn" onclick="toggleListen()">üé§ Escuchar voz</button>
        <button onclick="mostrarTareas()">üóÇÔ∏è Tareas / Actividades</button>
        <button onclick="abrirWidgetChatbase()">ü§ñ Tutor IA</button>
      </div>

      <div id="tareasArea" style="margin-top:10px"></div>

    </div>

    <hr style="margin:12px 0">

    <h4>Ranking y medallas</h4>
    <ul id="ranking"></ul>

    <div class="row" style="margin-top:10px">
      <button onclick="guardarTodo()">Guardar</button>
      <button onclick="cerrarSesion()">Cerrar sesi√≥n</button>
    </div>
  </div>

  <!-- LibreLingo -->
  <div class="card">
    <h4>Aliado: LibreLingo</h4>
    <div class="small">Puedes abrir LibreLingo en otra pesta√±a o aqu√≠ mismo (prueba las lecciones y vuelve a NICO).</div>
    <div class="row" style="margin-top:8px">
      <button onclick="window.open('https://librelingo.app','_blank')">Abrir LibreLingo</button>
      <button onclick="mostrarIframeLibre()">Abrir aqu√≠</button>
    </div>
    <div id="libreFrame" style="display:none;margin-top:10px">
      <iframe src="https://librelingo.app" style="width:100%;height:420px;border-radius:8px;border:1px solid #e3eef8"></iframe>
      <button onclick="cerrarIframeLibre()">Cerrar</button>
    </div>
  </div>

  <!-- Soporte t√©cnico -->
  <div class="card">
    <h4>Soporte t√©cnico</h4>
    <p class="small">¬øNecesitas ayuda? Ll√°manos o env√≠anos un mensaje.</p>
    <div class="row">
      <button onclick="location.href='tel:+18297425652'">Llamar: 829-742-5652</button>
      <button onclick="location.href='mailto:academynicovoxbot@gmail.com'">Escribir: academynicovoxbot@gmail.com</button>
    </div>
    <div class="small" style="margin-top:8px">Horario de soporte: Lunes a Viernes</div>
  </div>

</div>

<!-- Floating button to open chat/Tutor IA -->
<div class="float-ia" onclick="abrirWidgetChatbase()">ü§ñ Hablar con IA</div>

<footer>¬© NICO-VOXBOT ACADEMY ‚Äî Todos los derechos reservados</footer>

<!-- ===================== SCRIPTS ===================== -->
<script>
/* ---------------- CONFIG ---------------- */
const CONFIG = {
  CHATBASE_EMBED_ID: 'fxrgAJ48ExA_xk5xf9j_0', // tu ID real (pegado)
  PAYPAL_CLIENT_ID: '',  // deja vac√≠o hasta crear cuenta
  STRIPE_KEY: '',
  LANGUAGES: ['Ingl√©s','Franc√©s','Portugu√©s','Alem√°n','Italiano','Chino','Japon√©s','Coreano','Ruso','√Årabe','Hebreo','Turco','Holand√©s','Sueco','Noruego','Polaco','Griego','Hindi','Tailand√©s','Indonesio'],
  QUESTIONS_PER_LANG: 10000,
  QUESTIONS_PER_LEVEL: 20
};

/* ---------------- STATE ---------------- */
let user = JSON.parse(localStorage.getItem('nv_user') || 'null');
let progreso = JSON.parse(localStorage.getItem('nv_progreso') || '{}');
let idiomaActual = localStorage.getItem('nv_idioma') || CONFIG.LANGUAGES[0];
let bankCache = {}; // lazy generated
let preguntaActual = null;
let recognition = null;
let escuchando=false;

/* ---------------- UI Init ---------------- */
document.addEventListener('DOMContentLoaded', ()=>{
  // set mission
  document.getElementById('mision').innerHTML = '<strong>Somos una plataforma que ofrece clases de idiomas de la forma m√°s accesible e inteligente para garantizar su futuro, a un precio muy asequible.</strong>';
  // languages list
  const ll = document.getElementById('langList');
  CONFIG.LANGUAGES.forEach(lang=>{
    const b = document.createElement('button'); b.innerText = lang; b.onclick = ()=>{ selectLanguage(lang) }; ll.appendChild(b);
  });
  // idioma select
  const sel = document.getElementById('idiomaSelect');
  CONFIG.LANGUAGES.forEach(l=>{ const o=document.createElement('option'); o.value=l; o.text=l; sel.appendChild(o); });
  sel.value = idiomaActual;

  // register avatar input handler
  const avatarInput = document.getElementById('reg_avatar');
  avatarInput.addEventListener('change', (e)=> {
    const f = e.target.files[0]; if(!f) return;
    const r = new FileReader(); r.onload = ()=> {
      if(!user) user={}; user.avatar = r.result; saveUser();
    }; r.readAsDataURL(f);
  });

  // restore user & progreso
  if(user){ populateProfileUI(); showPanelCurso(); }
  CONFIG.LANGUAGES.forEach(lang=>{ if(!progreso[lang]) progreso[lang]={nivel:1,puntos:0,history:[]}; });
  ensureBank(idiomaActual);
  generarPregunta();
  actualizarUI();
  initRecognition();
  injectChatbase(); // inject if id present
});

/* ---------------- PROFILE / REGISTER ---------------- */
function registrar(){
  const n = document.getElementById('reg_name').value.trim();
  const e = document.getElementById('reg_email').value.trim();
  const a = document.getElementById('reg_age').value.trim();
  const tel = document.getElementById('reg_contact').value.trim();
  if(!n||!e){ alert('Nombre y correo son requeridos'); return; }
  user = {name:n,email:e,age:a,phone:tel,avatar:null};
  // if file already selected, it's loaded into user.avatar at file change handler
  saveUser();
  populateProfileUI();
  showPanelCurso();
  alert('Registrado: '+n);
}

function saveUser(){ localStorage.setItem('nv_user', JSON.stringify(user)); }
function populateProfileUI(){
  // hide register card, show name in header small place if needed
  const regCard = document.getElementById('card-register');
  if(regCard) regCard.classList.add('hidden');
  // show curso panel
  document.getElementById('panel-curso').classList.remove('hidden');
  // if avatar present show
  if(user && user.avatar){
    // show avatar small (optional)
  }
}

function abrirSesion(){
  // quick login by email
  const em = document.getElementById('reg_email').value.trim();
  if(!em && (!user || !user.email)){ alert('Ingresa tu correo o reg√≠strate'); return; }
  if(!user){ // if a user with email in localStorage?
    // if there's user stored, load it
    const stored = JSON.parse(localStorage.getItem('nv_user')||'null');
    if(stored && stored.email === em){ user = stored; populateProfileUI(); showPanelCurso(); return; }
  }
  if(user && user.email === em){ populateProfileUI(); showPanelCurso(); return; }
  alert('Sesi√≥n iniciada (modo demo)'); showPanelCurso();
}

function cerrarSesion(){ user=null; localStorage.removeItem('nv_user'); document.getElementById('panel-curso').classList.add('hidden'); document.getElementById('card-register').classList.remove('hidden'); }

/* ---------------- LANG BANK (lazy generate) ---------------- */
function ensureBank(lang){
  if(bankCache[lang]) return;
  const total = CONFIG.QUESTIONS_PER_LANG;
  const perLevel = CONFIG.QUESTIONS_PER_LEVEL;
  const arr = [];
  for(let i=0;i<total;i++){
    const nivel = Math.floor(i/perLevel)+1;
    const id = `${lang.substr(0,3).toUpperCase()}_${i+1}`;
    const correcta = `Tr_${i+1}`;
    const opciones = [correcta, `Distr_${i+101}`, `Distr_${i+202}`, `Distr_${i+303}`];
    // shuffle
    for(let j=opciones.length-1;j>0;j--){ const k = Math.floor(Math.random()*(j+1)); [opciones[j],opciones[k]]=[opciones[k],opciones[j]]; }
    arr.push({id,nivel,pregunta:`¬øCu√°l es la traducci√≥n de ${id}?`,correcta,opciones});
  }
  bankCache[lang]=arr;
}

/* ---------------- COURSE / QUESTIONS ---------------- */
function selectLanguage(lang){
  idiomaActual = lang; localStorage.setItem('nv_idioma',idiomaActual);
  document.getElementById('idiomaSelect').value = lang;
  ensureBank(lang); generarPregunta(); actualizarUI(); showPanelCurso();
}
function cambiarIdioma(){ idiomaActual = document.getElementById('idiomaSelect').value; ensureBank(idiomaActual); generarPregunta(); actualizarUI(); }

function generarPregunta(){
  const datos = progreso[idiomaActual];
  const lista = bankCache[idiomaActual].filter(q=>q.nivel===datos.nivel);
  if(!lista || lista.length===0){ document.getElementById('pregunta').innerText = '‚úÖ No hay preguntas para este nivel a√∫n.'; return; }
  preguntaActual = lista[Math.floor(Math.random()*lista.length)];
  document.getElementById('pregunta').innerText = preguntaActual.pregunta;
  // opciones
  for(let i=0;i<4;i++){ const el = document.getElementById('opt'+i); if(el) el.innerText = preguntaActual.opciones[i] || ('Opci√≥n '+(i+1)); }
  hablar(preguntaActual.pregunta);
}

function respuesta(index){
  if(!preguntaActual) return;
  const elegido = preguntaActual.opciones[index];
  const correcto = preguntaActual.correcta;
  const datos = progreso[idiomaActual];
  const ok = elegido === correcto;
  datos.history.push({id:preguntaActual.id,ans:elegido,ok,when:Date.now()});
  if(ok){ datos.puntos += 10; datos.nivel += 1; document.getElementById('mensaje').innerText = '‚úÖ Correcto'; }
  else { document.getElementById('mensaje').innerText = '‚ùå Incorrecto ‚Äî sigue practicando'; }
  guardarProgreso();
  verificarExamen();
  generarPregunta();
  actualizarUI();
}

/* ---------------- EXAMS & TASKS ---------------- */
function verificarExamen(){
  const datos = progreso[idiomaActual];
  if(datos.nivel % 5 === 0){
    // unlock exam UI
    document.getElementById('mensaje').innerText += ' ‚Äî ¬°Has desbloqueado el examen de nivel!';
  }
}

let tareasDemo = {
  // tasks per language -> per level (simple demo)
};
function mostrarTareas(){
  // show 3 tasks for this lesson/level
  const nivel = progreso[idiomaActual].nivel;
  const html = `<h4>Tareas y Actividades ‚Äî Nivel ${nivel}</h4>
    <div class="task">1) Aprende 10 nuevas palabras. (10 min)</div>
    <div class="task">2) Practica pronunciaci√≥n con la lecci√≥n (5 repeticiones)</div>
    <div class="task">3) Mini-ejercicio: traduce 5 frases.</div>
    <div style="margin-top:8px"><button onclick="marcarTareaHecha()">Marcar tarea como hecha</button></div>`;
  document.getElementById('tareasArea').innerHTML = html;
}

function marcarTareaHecha(){ // increment small points
  progreso[idiomaActual].puntos += 5;
  guardarProgreso(); actualizarUI(); alert('Tarea guardada: recibiste puntos'); }

/* ---------------- RANKING / MEDALS / SAVE ---------------- */
function actualizarUI(){
  const datos = progreso[idiomaActual];
  document.getElementById('nivel').innerText = datos.nivel;
  // puntos sum
  let total = 0;
  Object.keys(progreso).forEach(k=> total += progreso[k].puntos || 0);
  // ranking list simple
  const list = Object.keys(progreso).map(k=> `<li>${k} ‚Äî ${progreso[k].puntos} pts</li>`).join('');
  document.getElementById('ranking').innerHTML = list;
  // medallas: dynamic (example)
  const med = datos.puntos>=100 ? 'ü•á' : (datos.puntos>=50 ? 'ü•à' : 'ü•â');
  document.getElementById('medallas') && (document.getElementById('medallas').innerText = med);
}

function guardarProgreso(){ localStorage.setItem('nv_progreso', JSON.stringify(progreso)); }
function guardarTodo(){ guardarProgreso(); saveUser(); alert('Guardado localmente') }

/* ---------------- VOICE (TTS + STT) ---------------- */
function hablar(text){
  try{ const u = new SpeechSynthesisUtterance(text); u.lang = detectLangCode(idiomaActual); speechSynthesis.cancel(); speechSynthesis.speak(u);}catch(e){ console.warn(e); }
}
function hablarPregunta(){ if(preguntaActual) hablar(preguntaActual.pregunta); }

function detectLangCode(lang){
  const map = {'Ingl√©s':'en-US','Franc√©s':'fr-FR','Portugu√©s':'pt-PT','Alem√°n':'de-DE','Italiano':'it-IT','Chino':'zh-CN','Japon√©s':'ja-JP','Coreano':'ko-KR','Ruso':'ru-RU','√Årabe':'ar-SA','Hindi':'hi-IN','Espa√±ol':'es-ES'};
  return map[lang] || 'en-US';
}

function initRecognition(){
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SpeechRecognition) return;
  recognition = new SpeechRecognition(); recognition.lang = 'es-ES'; recognition.interimResults=false; recognition.continuous=false;
  recognition.onresult = (e)=>{ const text = e.results[0][0].transcript; document.getElementById('mensaje').innerText = 'Reconocido: '+text; // intentar contestar si coincide
    if(preguntaActual){
      preguntaActual.opciones.forEach((opt,idx)=>{ if(opt.toLowerCase().includes(text.toLowerCase()) || text.toLowerCase().includes(opt.toLowerCase())) respuesta(idx); });
    }
  };
  recognition.onend = ()=>{ escuchando=false; document.getElementById('listenBtn').innerText='üé§ Escuchar voz'; };
}
function toggleListen(){
  if(!recognition){ alert('Reconocimiento de voz no disponible en tu navegador.'); return; }
  if(escuchando){ recognition.stop(); escuchando=false; document.getElementById('listenBtn').innerText='üé§ Escuchar voz'; } else { recognition.start(); escuchando=true; document.getElementById('listenBtn').innerText='‚èπÔ∏è Parar'; }
}

/* ---------------- LIBRELINGO IFRAME ---------------- */
function mostrarIframeLibre(){ document.getElementById('libreFrame').style.display='block'; }
function cerrarIframeLibre(){ document.getElementById('libreFrame').style.display='none'; }

/* ---------------- PAYMENT MOCK ---------------- */
function prepararPagoMock(){ alert('Flujo de pago listo en modo prueba. Cuando tengas PayPal pega tu Client ID en el c√≥digo.'); const btn = document.getElementById('btn-pay'); btn.classList.remove('disabled'); btn.disabled=false; btn.innerText='Pagar (modo prueba)'; }

/* ---------------- HELPERS UI ---------------- */
function showPanelCurso(){ document.getElementById('panel-curso').classList.remove('hidden'); document.getElementById('card-register').classList.add('hidden'); }
function selectLanguageFromHeader(lang){ selectLanguage(lang); }

/* ---------------- INJECT CHATBASE ---------------- */
function injectChatbase(){
  if(!CONFIG.CHATBASE_EMBED_ID) return;
  try{
    if(!window.chatbase || window.chatbase("getState") !== "initialized"){
      window.chatbase=(...args)=>{ if(!window.chatbase.q) window.chatbase.q=[]; window.chatbase.q.push(args); };
      window.chatbase = new Proxy(window.chatbase, { get(target, prop){ if(prop==='q') return target.q; return (...a)=> target(prop, ...a); }});
    }
    const s = document.createElement('script'); s.src='https://www.chatbase.co/embed.min.js'; s.id = CONFIG.CHATBASE_EMBED_ID; s.defer = true; document.body.appendChild(s);
  }catch(e){ console.warn('Chatbase inject failed', e); }
}
function abrirWidgetChatbase(){ if(window.chatbase){ try{ window.chatbase('open'); return; }catch(e){} } alert('El widget de Chatbase no est√° disponible. Comprueba que CONFIG.CHATBASE_EMBED_ID tenga el ID correcto.'); }

/* ---------------- START helpers ---------------- */
function selectLanguage(lang){ selectLanguageAction(lang); }
function selectLanguageAction(lang){
  idiomaActual = lang; localStorage.setItem('nv_idioma',idiomaActual); ensureBank(idiomaActual); generarPregunta(); actualizarUI(); showPanelCurso();
}

/* ---------------- persist user/progreso if present ---------------- */
function saveUser(){ if(user) localStorage.setItem('nv_user', JSON.stringify(user)); }

/* ---------------- init recognition earlier ---------------- */
function initRecognition(){}
</script>

<!-- ========== CHATBASE EMBED (already injected by injectChatbase) ========== -->

</body>
</html>
